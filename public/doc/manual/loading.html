<h2 id="подключение-api">Подключение API</h2><p>Работа с картой возможна только после того, как будет загружена библиотека. Есть несколько способов это сделать. Начнем с простого.</p>
<h3 id="простой-способ">Простой способ</h3><p>Сперва подключим API карт, поместив в секцию head HTML-страницы следующий код:</p>
<pre><code>&lt;script src=&quot;http://maps.api.2gis.ru/2.0/loader.js?pkg=full&quot; data-id=&quot;dgLoader&quot;&gt;&lt;/script&gt;
</code></pre><p>Атрибут <code>data-id=&quot;dgLoader&quot;</code> обязательный.</p>
<p>Затем воспользуемся функцией DG.then, в которую поместим код инициализации карты:</p>
<pre><code>DG.then(function() {
    map = DG.map(&#39;map&#39;, {
        &#39;center&#39;: [54.98, 82.89],
        &#39;zoom&#39;: 13
    });
});
</code></pre><p>Внутри себя эта функция добавляет обработчик события загрузки страницы. Именно такой способ рассматривался в разделе «Быстрый старт».</p>
<h3 id="загрузка-по-требованию">Загрузка по требованию</h3><p>Вы можете загрузить API карт именно в тот момент, когда карта станет нужна. Для этого в URL подключения API необходимо добавить параметр <code>lazy=true</code>:</p>
<pre><code>&lt;script src=&quot;http://maps.api.2gis.ru/2.0/loader.js?pkg=full&amp;lazy=true&quot; data-id=&quot;dgLoader&quot;&gt;&lt;/script&gt;
</code></pre><p>Затем в нужный момент времени (например, при нажатии на кнопку) необходимо вызвать функцию DG.then:</p>
<pre><code>DG.then(function() {
    map = DG.map(&#39;map&#39;, {
        &#39;center&#39;: [54.98, 82.89],
        &#39;zoom&#39;: 13
    });
});
</code></pre><h3 id="опции-подключения">Опции подключения</h3><p>Ниже описаны все опции, которые может принимать URL загрузки API карт:</p>
<table>
    <thead>
        <tr>
            <th>Опция</th>
            <th>По умолчанию</th>
            <th>Описание</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>pkg</code></td>
            <td><code>full</code></td>
            <td>Пакет загружаемых модулей. На данный момент поддерживается 2 пакета: <code>full</code> - все модули API, <code>light</code> - базовая функциональность (балуны, маркера, геометрии).</td>
        </tr>
        <!--<tr>
            <td><code>mod</code></td>
            <td><code>null</code></td>
            <td>Перечень конкретных модулей для загрузки (через запятую). Если задать этот параметр, тогда параметр pkg будет проигнорирован.</td>
        </tr>-->
        <tr>
            <td><code>skin</code></td>
            <td><code>light</code></td>
            <td>Тема карты (светлая или темная). Принимает значение <code>light</code> или <code>dark</code>.</td>
        </tr>
        <tr>
            <td><code>mode</code></td>
            <td><code>null</code></td>
            <td>Если указать значение <code>debug</code>, тогда загрузится несжатый JavaScript код API (удобно при отладке приложений).</td>
        </tr>
        <tr>
            <td><code>lazy</code></td>
            <td><code>false</code></td>
            <td>Если указать значение <code>true</code>, тогда API карт загрузится отложено, при первом вызове <code>DG.then</code>.</td>
        </tr>
    </tbody>
</table>

<h3 id="функция-dgthen">Функция DG.then</h3><p>Как было описано ранее, функция <code>DG.then</code> отвечает за отслеживание момента загрузки API карт и добавление обработчиков этого действия. Параметры функции:</p>
<table>
    <thead>
        <tr>
            <th>Вызов</th>
            <th>Возвращает</th>
            <th>Описание</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>DG.then</b>(
                <nobr>&lt;Function&gt; <i>resolve</i>,</nobr>
                <nobr>&lt;Function&gt; <i>reject</i></nobr>&nbsp;)
            </code></td>
            <td><code>Promise</code></td>
            <td>Регистрирует обработчики загрузки API. Пареметры: resolve - сработает при успешной загрузке API карт, reject - в случае ошибки сервера.</td>
        </tr>
    </tbody>
</table>

<p>Вызов функции <code>DG.then</code> в любой момент после загрузки API мгновенно выполнит обработчик.</p>
<h2 id="подключение-сторонних-модулей">Подключение сторонних модулей</h2><p>API карт совместим с большинством модулей библиотеки Leaflet, также вы можете разработать и подключить <a href="https://github.com/2gis/maps-api-2.0/blob/master/CONTRIBUTING.md#%D0%9A%D0%B0%D0%BA-%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D1%82%D1%8C-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8C" target="_blank">собственный модуль</a>. Для подключения модулей используется функция <code>DG.plugin</code>. Ниже мы рассмотрим несколько примеров ее использования.</p>
<p>Использование функции <code>DG.plugin</code> в случае, когда модуль должен быть загружен до начала инициализации карты:</p>
<pre><code>// загрузка кода API карт
DG.then(function() {
    // загрузка кода модуля
    return DG.plugin(&#39;https://raw.github.com/mlevans/leaflet-hash/master/leaflet-hash.js&#39;);
})
.then(function() {
    // инициализация карты
    var map = DG.map(&#39;map&#39;, {
        &#39;center&#39;: [54.98, 82.89],
        &#39;zoom&#39;: 13
    });
    // инициализация модуля
    L.hash(map);
});
</code></pre><p>Если модуль не нужен на начальном этапе работы с картой, тогда можно использовать его отложенную загрузку и инициализацию (например, при клике на кнопку):</p>
<pre><code>// загрузка кода API карт
DG.then(function() {
    // инициализация карты
    map = DG.map(&#39;map&#39;, {
        &#39;center&#39;: [54.98, 82.89],
        &#39;zoom&#39;: 13
    });
});

// код, который может быть вызван по требованию
DG.then(function() {
    // загрузка кода модуля
    return DG.plugin(&#39;https://raw.github.com/mlevans/leaflet-hash/master/leaflet-hash.js&#39;);
}).then(function () {
    // инициализация модуля
    L.hash(map);
});
</code></pre><h3 id="функция-dgplugin">Функция DG.plugin</h3><p>Функция <code>DG.plugin</code> отвечает за загрузку модулей, которые не входят в базовые пакеты API карт и расположены на сторонних серверах. Параметры функции:</p>
<table>
    <thead>
        <tr>
            <th>Вызов</th>
            <th>Возвращает</th>
            <th>Описание</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>DG.plugin</b>(
                <nobr>&lt;String&gt; <i>url</i>&nbsp;|&nbsp;</nobr>
                <nobr>&lt;Array&gt; <i>[&lt;String&gt; url, &lt;String&gt; url, ...]</i></nobr>&nbsp;)
            </code></td>
            <td><code>Promise</code></td>
            <td>Загружает модули. В качестве параметров должны быть указкны прямые ссылки на js и css файлы.</td>
        </tr>
    </tbody>
</table>