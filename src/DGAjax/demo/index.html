<!DOCTYPE html>
<html>
<head>
    <title>DGAjax & DGPromise demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="http://maps.api.2gis.ru/2.0/loader.js?pkg=full&mode=debug"></script>
</head>
<body>

<div id="map" style="width: 100%; height: 600px; border: 1px solid #ccc;"></div>

<script type="text/javascript">

    // Avoid `console` errors in browsers that lack a console.
    (function() {
        var method;
        var noop = function () {};
        var methods = [
            'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',
            'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',
            'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',
            'timeStamp', 'trace', 'warn'
        ];
        var length = methods.length;
        var console = (window.console = window.console || {});

        while (length--) {
            method = methods[length];

            if (!console[method]) {
                console[method] = noop;
            }
        }
    }());

    L.onLoad(function () {

        var map = new L.Map('map', {
            center: new L.LatLng(54.980206086231, 82.898068362003),
            zoom: 17
        });

        function test_jsonp(){
            console.log('test_jsonp');
            return L.DG.ajax('http://catalog.api.2gis.ru/project/list', {
                type: 'jsonp',
                data: {
                    output: 'jsonp',
                    key: 'ruxlih0718',
                    version: 1.3,
                    lang: 'ru'
                },
                success: function(data) {
                    console.log('success', data);
                },
                error: function(error) {
                    console.warn('error', error);
                },
                progress: function(data) {
                    console.log('beforeSend', data);
                }
            }).then(
                function(data) { console.log('resolve', data) },
                function(error) { console.warn('reject', error) },
                function(data) { console.log('progress', data) }
            );
        };

        function test_get(){
            console.log('test_get');
            return L.DG.ajax('http://catalog.api.2gis.ru/project/list', {
                type: 'get',
                data: {
                    key: 'ruxlih0718',
                    version: 1.3,
                    lang: 'ru'
                },
                success: function(data) {
                    console.log('success', data);
                },
                error: function(error) {
                    console.warn('error', error);
                },
                progress: function(data) {
                    console.log('beforeSend', data);
                }
            }).then(
                function(data) { console.log('resolve', data) },
                function(error) { console.warn('reject', error) },
                function(data) { console.log('progress', data) }
            );
        };

        function test_post(){
            console.log('test_post');
            return L.DG.ajax('http://catalog.api.2gis.ru/project/list', {
                type: 'post',
                data: {
                    key: 'ruxlih0718',
                    version: 1.3,
                    lang: 'ru'
                },
                success: function(data) {
                    console.log('success', data);
                },
                error: function(error) {
                    console.warn('error', error);
                },
                progress: function(data) {
                    console.log('beforeSend', data);
                }
            }).then(
                function(data) { console.log('resolve', data) },
                function(error) { console.warn('reject', error) },
                function(data) { console.log('progress', data) }
            );
        };

        L.DomEvent.addListener( L.DomUtil.get('sendRequest'), 'click', function(){
            test_jsonp().then(test_get).then(test_post).then(function(){
                console.log('finish');
            });
        });

    });
</script>
<button id="sendRequest">Сделать запрос</button>
</body>
</html>
