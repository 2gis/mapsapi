## Подключение API

{toc}

### Описание

Работа с картой возможна только после того, как в браузер будет загружен код API карт. Есть несколько способов его загрузки.

### Простой способ

Сперва подключим API карт, поместив в секцию `head` HTML-страницы следующий код:

    <script src="http://maps.api.2gis.ru/2.0/loader.js?pkg=full"></script>

Затем воспользуемся функцией `DG.then`, в которую поместим код инициализации карты:

    DG.then(function() {
        map = DG.map('map', {
            'center': [54.98, 82.89],
            'zoom': 13
        });
    });

Внутри себя эта функция добавляет обработчик события загрузки страницы. Именно такой способ рассматривался в разделе [«Быстрый старт»](/doc/maps/quickstart).

### Загрузка по требованию

Вы можете загрузить API карт именно в тот момент, когда карта станет нужна. Для этого в URL подключения API необходимо добавить параметр `lazy=true`:

    <script src="http://maps.api.2gis.ru/2.0/loader.js?pkg=full&lazy=true"></script>

Затем в нужный момент времени (например, при нажатии на кнопку) необходимо вызвать функцию DG.then:

    DG.then(function() {
        map = DG.map('map', {
            'center': [54.98, 82.89],
            'zoom': 13
        });
    });

### Опции подключения

Ниже описаны все опции, которые может принимать URL загрузки API карт:

<table>
    <thead>
        <tr>
            <th>Опция</th>
            <th>По умолчанию</th>
            <th>Описание</th>
        </tr>
    </thead>
    <tbody>
        <tr id="loading-pkg">
            <td><code>pkg</code></td>
            <td><code>full</code></td>
            <td>Пакет загружаемых модулей. На данный момент поддерживается 2 пакета: `full` — все модули API; `basic` — базовая функциональность (балуны, маркеры, геометрии).</td>
        </tr>
        <tr>
            <td><code>skin</code></td>
            <td><code>dark</code></td>
            <td>Тема управляющих элементов (светлая или темная). Принимает значение `light` или `dark`.</td>
        </tr>
        <tr>
            <td><code>lazy</code></td>
            <td><code>false</code></td>
            <td>Если указать значение `true`, тогда API карт загрузится отложенно, при первом вызове `DG.then`.</td>
        </tr>
    </tbody>
</table>

### Функция DG.then

Как было описано ранее, функция `DG.then` отвечает за отслеживание момента загрузки API карт и добавление обработчиков этого действия. Параметры функции:

<table>
    <thead>
        <tr>
            <th>Вызов</th>
            <th>Возвращает</th>
            <th>Описание</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>DG.then</b>(
                <nobr>&lt;Function&gt; <i>resolve</i>,</nobr>
                <nobr>&lt;Function&gt; <i>reject</i></nobr>&nbsp;)
            </code></td>
            <td><code>Promise</code></td>
            <td>Регистрирует обработчики загрузки API. Пареметры: `resolve` — функция, срабатывающая при успешной загрузке API карт, `reject` — функция, срабатывающая в случае ошибки сервера.</td>
        </tr>
    </tbody>
</table>

Вызов функции `DG.then` в любой момент после загрузки API мгновенно выполнит обработчик.
